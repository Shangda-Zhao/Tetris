# 俄罗斯方块

## 简介

俄罗斯方块是由俄罗斯人阿列克谢·帕基特诺夫发明的，故得此名。它是一款电视游戏机和掌上游戏机游戏，由于操作简单，规则易懂，因此它面对的是那些没有精力或兴趣玩大型游戏的玩家，而这些人也恰巧需要一类简单好玩的游戏，拿起来就能进入状态，在忙碌的生活中寻求片刻放松。在此次实验当中，要采用 C 语言进行俄罗斯方块的程序设计，初步实现俄罗斯方块这款游戏的基本功能。

实验主要使用的是 C 语言的有关原理与技术，其中包括一些常见的基本操作、定义、语句；但是也用到了许多其它之前没有学习过的知识，例如，在产生板块的函数当中，运用到了矩阵的旋转的有关内容、 在移动光标和隐藏光标时使用的SetConsoleCursorPosition 、GetStdHandle、GetConsoleCursorInfo 的有关语句、判断当前是否有键盘输入的 kbhit()、
随机数产生函数 srand()、延迟函数：Sleep()、缓冲文件系统所提供的函数等等。

## 设计思路

### 1. 游戏界面的设计

游戏界面分成左右两部分，其中左面为游戏区，玩家在游戏区内进行操作，板块的下落，叠加，消除，均在游戏区内完成；右面为功能显示区，为玩家显示一些与游戏有关的信息。游戏界面的边界用星形构成。用一个矩阵来保存界面的每一个位置，包括颜色跟数值，数值用来区分是墙还是方块还是空格，便于运行时的判断。

### 2. 方块和板块的类型定义

建立方块结构体，其中包括数值和颜色，数值 1 表示方块，0 表示空格。然后用 4*4矩阵储存板块的信息。

### 3. 板块的产生以及板块形状的改变

通过上面第2步，可以很容易的产生板块。板块的产生可以由随机数控制，而板块的初始形状有 7 个，再利用矩阵的旋转，可以得到剩下的 21 个板块。

### 4. 判断板块是否可以左右移动和旋转
ch=getch(); //从键盘接收
 switch(ch) //移动
 {
 case LEFT: if(panduan(n,space_c,x,y-1)==1) 
 { draw_kong(n,space_c,x,y);
 y--;
 }
break;
 case RIGHT: if(panduan(n,space_c,x,y+1)==1) 
 { draw_kong(n,space_c,x,y);
 y++;
 }
break;
 case DOWN: if(panduan(n,space_c,x+1,y)==1)
 { draw_kong(n,space_c,x,y);
 x++;
 }
break;
 case SPACE: if(panduan(n,(space_c+1)%4,x+1,y)==1) 
 { draw_kong(n,space_c,x,y);
 space_c=(space_c+1)%4;
 }
break;

### 5. 判断板块是否到底

运行时先判断再运行，可以保证不会越过墙。每一步判断 4*4 的板块矩阵下一格是否是方块，是方块就落在上面。判断函数如下

### 6. 板块填满一行或几行时，消除，并且分数+100

设立一个计数器，对每一行的方块数目进行相加，并和每一行所能容纳的方块的最大数目进行比较，若相等，则改变矩阵的信息，对方块进行消除，同时，把分数再加 100，实时输出。

**一个板块落到底便判断是否满一行，满一行减掉，在判断是否满一行，未满则生成下一个板块。**

### 7. 游戏的暂停，重新开始与退出

当按下 S/s 键后，游戏暂停，按 enter 键时，游戏继续；当按下 R/r 键后，游戏重新开始，分数清零，重新执行主函数；当按下 Esc 键后，游戏退出。利用 kbhit()判断当前是否有键盘输入，如果有输入就跳出。这一步比较简单。

### 8. 最高记录的保存和读取

利用缓冲文件系统所提供的函数，创建.txt 文件，对分数进行写入和读取，若一局的分数高于最高记录，则重新保存。

### 9. 游戏结束的判定

即判断最顶上一行是否有方块。这一步也比较简单。

### 10. 游戏结束界面的设计

游戏结束后有三种情况：1）恭喜您打破记录，目前最高纪录为 XX、2）与纪录持平，请突破你的极限！3）请继续努力，你与最高记录只差：XX。并且显示 GAME OVER! 提示玩家选择重新开始或退出游戏。若选择重新开始，则分数清零，重新执行主函数；若选择退出游戏，则游戏结束。

## 运行结果

### 游戏进行过程中

![进行](photo/ing.png)

### 选择退出 ESC 之后的界面

![退出](photo/esc.png)

### 游戏结束后的界面

**(1) 打破最高记录**

![打破记录](photo/打破纪录.png)

**(2) 与最高记录持平**

![持平](photo/持平.png)

**(3) 没有达到最高纪录**

![继续努力](photo/继续努力.png)

### 游戏结束之后，是否重新开始游戏

**(1)  输入 y 之后，退出游戏**

![退出](photo/退出.png)

**(2) 当输入错误时**

![输入错误](photo/输入错误.png)

